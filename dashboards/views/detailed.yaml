# =============================================================================
# Level 2: Detailed Dashboard - Expandable sections with more context
# =============================================================================
# This view provides more detail with expandable sections
# Good for daily check-ins and monitoring
#
# Copy to your HA dashboard or include in a tabbed view
# =============================================================================

title: Crypto Detailed
icon: mdi:view-list
path: crypto-detailed
type: sections

sections:
  # === Smart Summary Section ===
  - type: grid
    title: "üìä –û–±–∑–æ—Ä —Ä—ã–Ω–∫–∞ / Market Overview"
    columns: 2
    cards:
      # Market Pulse with details
      - type: custom:mushroom-template-card
        primary: >-
          {{ states('sensor.crypto_inspect_market_pulse') }}
        secondary: >-
          –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {{ states('sensor.crypto_inspect_market_pulse_confidence') }}%
          {{ state_attr('sensor.crypto_inspect_market_pulse', 'reason_ru') }}
        icon: mdi:pulse
        icon_color: >-
          {% set sentiment = states('sensor.crypto_inspect_market_pulse') %}
          {% if '–ë—ã—á–∏–π' in sentiment %}green{% elif '–ú–µ–¥–≤–µ–∂–∏–π' in sentiment %}red{% else %}orange{% endif %}
        multiline_secondary: true
        tap_action:
          action: more-info

      # Today's Action with details
      - type: custom:mushroom-template-card
        primary: >-
          {{ states('sensor.crypto_inspect_today_action') }}
        secondary: >-
          –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {{ states('sensor.crypto_inspect_today_action_priority') }}
          {{ state_attr('sensor.crypto_inspect_today_action', 'details_ru') }}
        icon: mdi:clipboard-check
        icon_color: >-
          {% set priority = state_attr('sensor.crypto_inspect_today_action_priority', 'priority') %}
          {% if priority == 'high' %}red{% elif priority == 'medium' %}orange{% else %}green{% endif %}
        multiline_secondary: true

  # === Portfolio Section ===
  - type: grid
    title: "üíº –ü–æ—Ä—Ç—Ñ–µ–ª—å / Portfolio"
    columns: 2
    cards:
      # Portfolio Health
      - type: custom:mushroom-template-card
        primary: >-
          –ó–¥–æ—Ä–æ–≤—å–µ: {{ states('sensor.crypto_inspect_portfolio_health') }}
        secondary: >-
          Score: {{ states('sensor.crypto_inspect_portfolio_health_score') }}%
          {{ state_attr('sensor.crypto_inspect_portfolio_health', 'main_issue_ru') }}
        icon: mdi:shield-check
        icon_color: >-
          {% set score = states('sensor.crypto_inspect_portfolio_health_score') | int(50) %}
          {% if score > 70 %}green{% elif score > 40 %}orange{% else %}red{% endif %}
        multiline_secondary: true

      # Portfolio Value
      - type: custom:mushroom-template-card
        primary: >-
          ${{ states('sensor.crypto_inspect_portfolio_value') | float | round(2) }}
        secondary: >-
          24h: {{ states('sensor.crypto_inspect_portfolio_pnl_24h') }}%
        icon: mdi:wallet
        icon_color: >-
          {% set pnl = states('sensor.crypto_inspect_portfolio_pnl_24h') | float(0) %}
          {% if pnl > 0 %}green{% elif pnl < 0 %}red{% else %}grey{% endif %}

  # === Goal Tracking Section ===
  - type: conditional
    conditions:
      - entity: sensor.crypto_inspect_goal_progress
        state_not: unavailable
    card:
      type: vertical-stack
      title: "üéØ –¶–µ–ª—å / Goal"
      cards:
        - type: custom:mushroom-template-card
          primary: >-
            {{ state_attr('sensor.crypto_inspect_goal_target', 'goal_name_ru') }}
          secondary: >-
            {{ states('sensor.crypto_inspect_goal_progress') }} ‚Ä¢
            –û—Å—Ç–∞–ª–æ—Å—å: ${{ states('sensor.crypto_inspect_goal_remaining') }}
          icon: mdi:trophy
          icon_color: amber

        - type: gauge
          entity: sensor.crypto_inspect_goal_progress
          name: –ü—Ä–æ–≥—Ä–µ—Å—Å –∫ —Ü–µ–ª–∏
          min: 0
          max: 100
          severity:
            green: 75
            yellow: 25
            red: 0

  # === Alerts Section ===
  - type: grid
    title: "üîî –û–ø–æ–≤–µ—â–µ–Ω–∏—è / Alerts"
    columns: 2
    cards:
      - type: custom:mushroom-template-card
        primary: >-
          {{ states('sensor.crypto_inspect_pending_alerts_count') }} –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
        secondary: >-
          –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö: {{ states('sensor.crypto_inspect_pending_alerts_critical') }}
        icon: mdi:bell-badge
        icon_color: >-
          {% if states('sensor.crypto_inspect_pending_alerts_critical') | int > 0 %}red
          {% elif states('sensor.crypto_inspect_pending_alerts_count') | int > 0 %}orange
          {% else %}green{% endif %}

      - type: custom:mushroom-template-card
        primary: >-
          {{ states('sensor.crypto_inspect_daily_digest_ready') }}
        secondary: >-
          –†–µ–∂–∏–º: {{ states('sensor.crypto_inspect_notification_mode') }}
        icon: mdi:newspaper
        icon_color: blue

  # === Briefings Section ===
  - type: grid
    title: "üì∞ –ë—Ä–∏—Ñ–∏–Ω–≥–∏ / Briefings"
    columns: 2
    cards:
      - type: custom:mushroom-template-card
        primary: –£—Ç—Ä–µ–Ω–Ω–∏–π –±—Ä–∏—Ñ–∏–Ω–≥
        secondary: >-
          {{ states('sensor.crypto_inspect_morning_briefing') }}
        icon: mdi:weather-sunny
        icon_color: amber

      - type: custom:mushroom-template-card
        primary: –í–µ—á–µ—Ä–Ω–∏–π –±—Ä–∏—Ñ–∏–Ω–≥
        secondary: >-
          {{ states('sensor.crypto_inspect_evening_briefing') }}
        icon: mdi:weather-night
        icon_color: indigo

  # === Market Indicators Section ===
  - type: grid
    title: "üìà –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã / Indicators"
    columns: 3
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_fear_greed
        name: Fear & Greed
        icon: mdi:emoticon-neutral

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_btc_dominance
        name: BTC Dominance
        icon: mdi:crown

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_altseason_status
        name: Altseason
        icon: mdi:rocket-launch

      - type: custom:mushroom-template-card
        primary: "RSI"
        secondary: |
          {% set data = states('sensor.crypto_inspect_ta_rsi') | from_json %}
          BTC: {{ data.BTC | default('N/A') }} | ETH: {{ data.ETH | default('N/A') }}
        icon: mdi:chart-line

      - type: custom:mushroom-template-card
        primary: "Trend"
        secondary: |
          {% set data = states('sensor.crypto_inspect_ta_trend') | from_json %}
          BTC: {{ data.BTC | default('N/A') }} | ETH: {{ data.ETH | default('N/A') }}
        icon: mdi:trending-up

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_risk_status
        name: Risk Status
        icon: mdi:shield-alert

  # === Weekly Outlook Section ===
  - type: grid
    title: "üìÖ –ù–µ–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ / Weekly Outlook"
    columns: 1
    cards:
      - type: markdown
        content: >-
          **{{ states('sensor.crypto_inspect_weekly_outlook') }}**

          {{ state_attr('sensor.crypto_inspect_weekly_outlook', 'key_events_ru') | join(', ') if state_attr('sensor.crypto_inspect_weekly_outlook', 'key_events_ru') else '–ù–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π' }}
