# ==============================================================================
# Crypto Inspect - Whale Alert Blueprint
# ==============================================================================
# Notifies on large whale movements
# ==============================================================================

blueprint:
  name: Whale Movement Alert
  description: Get notified when whales move large amounts
  domain: automation
  source_url: https://github.com/Mesteriis/crypto-inspector/blob/main/blueprints/whale_alert.yaml

  input:
    notify_device:
      name: Device to notify
      selector:
        device:
          integration: mobile_app

trigger:
  - platform: state
    entity_id: sensor.crypto_inspect_whale_last_alert
    not_to:
      - "unknown"
      - "unavailable"

condition:
  - condition: template
    value_template: "{{ trigger.from_state.state != trigger.to_state.state }}"

action:
  - service: notify.mobile_app_{{ device_attr('!input notify_device', 'name') | slugify }}
    data:
      title: "ğŸ‹ Whale Alert"
      message: >-
        {% set alert = states('sensor.crypto_inspect_whale_last_alert') %}
        {% set net_flow = states('sensor.crypto_inspect_whale_net_flow') %}
        {% set count = states('sensor.crypto_inspect_whale_alerts_24h') %}

        {% if is_state('input_select.crypto_notification_language', 'Russian') %}
        {{ alert }}

        ğŸ“Š Ğ—Ğ° 24Ñ‡: {{ count }} Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²
        ğŸ’¹ ĞĞµÑ‚Ñ‚Ğ¾-Ğ¿Ğ¾Ñ‚Ğ¾Ğº: {{ net_flow }}
        {% else %}
        {{ alert }}

        ğŸ“Š 24h alerts: {{ count }}
        ğŸ’¹ Net flow: {{ net_flow }}
        {% endif %}
      data:
        tag: whale_alert
        group: crypto_whales

mode: single
