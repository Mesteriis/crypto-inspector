# =============================================================================
# –ö–ò–¢–´ –ò ON-CHAIN –ê–ö–¢–ò–í–ù–û–°–¢–¨
# =============================================================================
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫—Ä—É–ø–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤

# -----------------------------------------------------------------------------
# 38. Whale Alert - –∫—Ä—É–ø–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
# -----------------------------------------------------------------------------
- id: crypto_whale_alert
  alias: "Crypto: Whale Alert"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫—Ä—É–ø–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–∏—Ç–∞"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_whale_last_alert
  condition:
    - condition: template
      value_template: >
        {{ trigger.to_state.state != trigger.from_state.state and
           trigger.to_state.state not in ['unknown', 'unavailable', 'none'] }}
  action:
    - service: notify.mobile_app
      data:
        title: "üêã Whale Alert"
        message: "{{ states('sensor.crypto_inspect_whale_last_alert') }}"

# -----------------------------------------------------------------------------
# 39. –ë–æ–ª—å—à–æ–π –æ—Ç—Ç–æ–∫ —Å –±–∏—Ä–∂
# -----------------------------------------------------------------------------
- id: crypto_exchange_outflow
  alias: "Crypto: –û—Ç—Ç–æ–∫ —Å –±–∏—Ä–∂"
  description: "–ö—Ä—É–ø–Ω—ã–π –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —Å –±–∏—Ä–∂ - –±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_exchange_flow_signal
      to: "strong_outflow"
  action:
    - service: notify.mobile_app
      data:
        title: "üì§ –û—Ç—Ç–æ–∫ —Å –±–∏—Ä–∂"
        message: "–ö—Ä—É–ø–Ω—ã–π –≤—ã–≤–æ–¥ BTC —Å –±–∏—Ä–∂. –í–æ–∑–º–æ–∂–Ω–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∫–∏—Ç–∞–º–∏"
        data:
          tag: exchange_flow

# -----------------------------------------------------------------------------
# 40. –ë–æ–ª—å—à–æ–π –ø—Ä–∏—Ç–æ–∫ –Ω–∞ –±–∏—Ä–∂–∏
# -----------------------------------------------------------------------------
- id: crypto_exchange_inflow
  alias: "Crypto: –ü—Ä–∏—Ç–æ–∫ –Ω–∞ –±–∏—Ä–∂–∏"
  description: "–ö—Ä—É–ø–Ω—ã–π –≤–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∏—Ä–∂–∏ - –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_exchange_flow_signal
      to: "strong_inflow"
  action:
    - service: notify.mobile_app
      data:
        title: "üì• –ü—Ä–∏—Ç–æ–∫ –Ω–∞ –±–∏—Ä–∂–∏"
        message: "–ö—Ä—É–ø–Ω—ã–π –≤–≤–æ–¥ BTC –Ω–∞ –±–∏—Ä–∂–∏. –í–æ–∑–º–æ–∂–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂"
        data:
          tag: exchange_flow

# -----------------------------------------------------------------------------
# 41. Whale Net Flow –∏–∑–º–µ–Ω–∏–ª—Å—è
# -----------------------------------------------------------------------------
- id: crypto_whale_net_flow
  alias: "Crypto: Whale Net Flow"
  description: "–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ net flow –∫–∏—Ç–æ–≤"
  trigger:
    - platform: template
      value_template: >
        {{ states('sensor.crypto_inspect_whale_net_flow') | float(0) | abs > 10000 }}
  action:
    - service: notify.mobile_app
      data:
        title: "üêã Whale Flow"
        message: >
          {% set flow = states('sensor.crypto_inspect_whale_net_flow') | float(0) %}
          –ö–∏—Ç—ã {{ '–Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç' if flow > 0 else '–ø—Ä–æ–¥–∞—é—Ç' }}: {{ flow | abs | round(0) }} BTC

# -----------------------------------------------------------------------------
# 42. –ú–Ω–æ–≥–æ whale alerts –∑–∞ 24—á
# -----------------------------------------------------------------------------
- id: crypto_whale_activity_high
  alias: "Crypto: –í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∏—Ç–æ–≤"
  description: "–ú–Ω–æ–≥–æ –∫—Ä—É–ø–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24—á"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_whale_alerts_24h
      above: 10
  action:
    - service: notify.mobile_app
      data:
        title: "üêã –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∏—Ç–æ–≤"
        message: "{{ states('sensor.crypto_inspect_whale_alerts_24h') }} whale alerts –∑–∞ 24—á. –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!"
