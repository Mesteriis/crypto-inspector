# =============================================================================
# –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó
# =============================================================================
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

# -----------------------------------------------------------------------------
# 7. RSI –≤ –∑–æ–Ω–µ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏ (<30)
# -----------------------------------------------------------------------------
- id: crypto_rsi_oversold
  alias: "Crypto: RSI –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å"
  description: "RSI –Ω–∏–∂–µ 30 - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–∫—É–ø–∫–∏"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_ta_rsi
      below: 30
  condition:
    - condition: state
      entity_id: input_boolean.crypto_ta_alerts_enabled
      state: "on"
  action:
    - service: notify.mobile_app
      data:
        title: "üìâ RSI –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å"
        message: "RSI = {{ states('sensor.crypto_inspect_ta_rsi') }}. –†—ã–Ω–æ–∫ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–∫—É–ø–∫–∏"
        data:
          tag: rsi_alert

# -----------------------------------------------------------------------------
# 8. RSI –≤ –∑–æ–Ω–µ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏ (>70)
# -----------------------------------------------------------------------------
- id: crypto_rsi_overbought
  alias: "Crypto: RSI –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å"
  description: "RSI –≤—ã—à–µ 70 - –≤–æ–∑–º–æ–∂–Ω–æ —Å—Ç–æ–∏—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_ta_rsi
      above: 70
  condition:
    - condition: state
      entity_id: input_boolean.crypto_ta_alerts_enabled
      state: "on"
  action:
    - service: notify.mobile_app
      data:
        title: "üìà RSI –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å"
        message: "RSI = {{ states('sensor.crypto_inspect_ta_rsi') }}. –†—ã–Ω–æ–∫ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω - —Ä–∞—Å—Å–º–æ—Ç—Ä–∏ —Ñ–∏–∫—Å–∞—Ü–∏—é –ø—Ä–∏–±—ã–ª–∏"
        data:
          tag: rsi_alert

# -----------------------------------------------------------------------------
# 9. MACD –±—ã—á–∏–π –∫—Ä–æ—Å—Å–æ–≤–µ—Ä
# -----------------------------------------------------------------------------
- id: crypto_macd_bullish_cross
  alias: "Crypto: MACD –±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª"
  description: "MACD –ø–µ—Ä–µ—Å—ë–∫ —Å–∏–≥–Ω–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_ta_macd_signal
      to: "bullish_cross"
  action:
    - service: notify.mobile_app
      data:
        title: "üü¢ MACD –ë—ã—á–∏–π"
        message: "MACD –¥–∞–ª –±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª - –Ω–∞—á–∞–ª–æ –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞?"

# -----------------------------------------------------------------------------
# 10. MACD –º–µ–¥–≤–µ–∂–∏–π –∫—Ä–æ—Å—Å–æ–≤–µ—Ä
# -----------------------------------------------------------------------------
- id: crypto_macd_bearish_cross
  alias: "Crypto: MACD –º–µ–¥–≤–µ–∂–∏–π —Å–∏–≥–Ω–∞–ª"
  description: "MACD –ø–µ—Ä–µ—Å—ë–∫ —Å–∏–≥–Ω–∞–ª—å–Ω—É—é –ª–∏–Ω–∏—é —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_ta_macd_signal
      to: "bearish_cross"
  action:
    - service: notify.mobile_app
      data:
        title: "üî¥ MACD –ú–µ–¥–≤–µ–∂–∏–π"
        message: "MACD –¥–∞–ª –º–µ–¥–≤–µ–∂–∏–π —Å–∏–≥–Ω–∞–ª - –≤–æ–∑–º–æ–∂–Ω–æ–µ –Ω–∞—á–∞–ª–æ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏"

# -----------------------------------------------------------------------------
# 11. –°–∏–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–∏–≥–Ω–∞–ª –Ω–∞ –ø–æ–∫—É–ø–∫—É
# -----------------------------------------------------------------------------
- id: crypto_strong_buy_signal
  alias: "Crypto: –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª BUY"
  description: "–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –ø–æ–∫—É–ø–∫—É"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_ta_confluence
      above: 75
  condition:
    - condition: template
      value_template: "{{ states('sensor.crypto_inspect_ta_signal') == 'strong_buy' }}"
  action:
    - service: notify.mobile_app
      data:
        title: "üíö STRONG BUY"
        message: "Confluence {{ states('sensor.crypto_inspect_ta_confluence') }}%. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø–æ–∫—É–ø–∫—É!"
        data:
          priority: high

# -----------------------------------------------------------------------------
# 12. –°–∏–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–∏–≥–Ω–∞–ª –Ω–∞ –ø—Ä–æ–¥–∞–∂—É
# -----------------------------------------------------------------------------
- id: crypto_strong_sell_signal
  alias: "Crypto: –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª SELL"
  description: "–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_ta_confluence
      below: 25
  condition:
    - condition: template
      value_template: "{{ states('sensor.crypto_inspect_ta_signal') == 'strong_sell' }}"
  action:
    - service: notify.mobile_app
      data:
        title: "üíî STRONG SELL"
        message: "Confluence {{ states('sensor.crypto_inspect_ta_confluence') }}%. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∂—É!"
        data:
          priority: high

# -----------------------------------------------------------------------------
# 13. –°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–¥–∞
# -----------------------------------------------------------------------------
- id: crypto_trend_change
  alias: "Crypto: –°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–¥–∞"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ–±—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_ta_trend
  condition:
    - condition: template
      value_template: >
        {{ trigger.from_state.state != trigger.to_state.state and 
           trigger.from_state.state not in ['unknown', 'unavailable'] }}
  action:
    - service: notify.mobile_app
      data:
        title: "üîÑ –°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–¥–∞"
        message: "–¢—Ä–µ–Ω–¥ –∏–∑–º–µ–Ω–∏–ª—Å—è: {{ trigger.from_state.state }} ‚Üí {{ trigger.to_state.state }}"

# -----------------------------------------------------------------------------
# 14. –î–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞
# -----------------------------------------------------------------------------
- id: crypto_divergence_detected
  alias: "Crypto: –î–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞"
  description: "Price/RSI –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è - –ø—Ä–µ–¥–≤–µ—Å—Ç–Ω–∏–∫ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_divergences_active
      above: 0
  action:
    - service: notify.mobile_app
      data:
        title: "‚ö° –î–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è!"
        message: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è - –≤–æ–∑–º–æ–∂–µ–Ω —Ä–∞–∑–≤–æ—Ä–æ—Ç —Ç—Ä–µ–Ω–¥–∞"
