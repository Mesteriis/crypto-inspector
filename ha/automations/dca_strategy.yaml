# =============================================================================
# DCA Ð˜ Ð¡Ð¢Ð ÐÐ¢Ð•Ð“Ð˜Ð¯ ÐÐÐšÐžÐŸÐ›Ð•ÐÐ˜Ð¯
# =============================================================================
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Dollar Cost Averaging

# -----------------------------------------------------------------------------
# 33. DCA ÑÐ¸Ð³Ð½Ð°Ð» - Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸
# -----------------------------------------------------------------------------
- id: crypto_dca_good_time
  alias: "Crypto: DCA Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚"
  description: "Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ñ‹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ DCA"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_dca_signal
      to: "buy"
  condition:
    - condition: state
      entity_id: input_boolean.crypto_dca_alerts_enabled
      state: "on"
  action:
    - service: notify.mobile_app
      data:
        title: "ðŸ’° DCA ÑÐ¸Ð³Ð½Ð°Ð»"
        message: "Ð¥Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸. DCA Risk: {{ states('sensor.crypto_inspect_dca_risk_score') }}"
        data:
          tag: dca_signal

# -----------------------------------------------------------------------------
# 34. DCA Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ (ÐµÐ¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¾)
# -----------------------------------------------------------------------------
- id: crypto_dca_weekly_reminder
  alias: "Crypto: Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¾Ðµ DCA Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ"
  description: "ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ð¹ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐµ"
  trigger:
    - platform: time
      at: "10:00:00"
  condition:
    - condition: time
      weekday: [mon]
    - condition: state
      entity_id: input_boolean.crypto_dca_reminders_enabled
      state: "on"
  action:
    - service: notify.mobile_app
      data:
        title: "ðŸ“… DCA Ð¿Ð¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº"
        message: >
          Ð’Ñ€ÐµÐ¼Ñ ÐµÐ¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸!
          DCA ÑÐ¸Ð³Ð½Ð°Ð»: {{ states('sensor.crypto_inspect_dca_signal') }}
          Risk score: {{ states('sensor.crypto_inspect_dca_risk_score') }}

# -----------------------------------------------------------------------------
# 35. ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð·Ð¾Ð½Ð° DCA
# -----------------------------------------------------------------------------
- id: crypto_dca_optimal_zone
  alias: "Crypto: ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ DCA Ð·Ð¾Ð½Ð°"
  description: "Ð¦ÐµÐ½Ð° Ð² Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð·Ð¾Ð½Ðµ Ð´Ð»Ñ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ"
  trigger:
    - platform: template
      value_template: >
        {{ states('sensor.crypto_inspect_dca_risk_score') | int(50) < 30 }}
  action:
    - service: notify.mobile_app
      data:
        title: "ðŸŽ¯ ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð·Ð¾Ð½Ð° DCA"
        message: "Ð Ð¸ÑÐº Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð½Ð¸Ð·ÐºÐ¸Ð¹ ({{ states('sensor.crypto_inspect_dca_risk_score') }}). ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ!"
        data:
          priority: high

# -----------------------------------------------------------------------------
# 36. DCA Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð° Ð¼ÐµÑÑÑ†
# -----------------------------------------------------------------------------
- id: crypto_dca_monthly_result
  alias: "Crypto: DCA Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð·Ð° Ð¼ÐµÑÑÑ†"
  description: "Ð•Ð¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ DCA ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸"
  trigger:
    - platform: time
      at: "09:00:00"
  condition:
    - condition: template
      value_template: "{{ now().day == 1 }}"
  action:
    - service: notify.mobile_app
      data:
        title: "ðŸ“Š DCA Ð¾Ñ‚Ñ‡Ñ‘Ñ‚"
        message: "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ DCA Ð·Ð° Ð¼ÐµÑÑÑ†: {{ states('sensor.crypto_inspect_dca_result') }}"

# -----------------------------------------------------------------------------
# 37. ÐÐµ Ð¿Ð¾ÐºÑƒÐ¿Ð°Ñ‚ÑŒ ÑÐµÐ¹Ñ‡Ð°Ñ (Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº)
# -----------------------------------------------------------------------------
- id: crypto_dca_avoid
  alias: "Crypto: DCA Ð½Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ"
  description: "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº - Ð»ÑƒÑ‡ÑˆÐµ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_dca_risk_score
      above: 80
  action:
    - service: notify.mobile_app
      data:
        title: "â›” DCA Ð½Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ"
        message: "Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ñ€Ð¸ÑÐº Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ ({{ states('sensor.crypto_inspect_dca_risk_score') }}). Ð›ÑƒÑ‡ÑˆÐµ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ"
