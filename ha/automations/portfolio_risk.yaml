# =============================================================================
# –ü–û–†–¢–§–û–õ–ò–û –ò –†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ú–ï–ù–¢
# =============================================================================
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º –∏ —Ä–∏—Å–∫–∞–º–∏

# -----------------------------------------------------------------------------
# 15. –ü—Ä–æ—Å–∞–¥–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è > 10%
# -----------------------------------------------------------------------------
- id: crypto_portfolio_drawdown_warning
  alias: "Crypto: –ü—Ä–æ—Å–∞–¥–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"
  description: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ—Å–∞–¥–∫–µ –±–æ–ª–µ–µ 10%"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_portfolio_current_drawdown
      above: 10
  action:
    - service: notify.mobile_app
      data:
        title: "‚ö†Ô∏è –ü—Ä–æ—Å–∞–¥–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è"
        message: "–¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: {{ states('sensor.crypto_inspect_portfolio_current_drawdown') }}%"
        data:
          priority: high
          tag: drawdown

# -----------------------------------------------------------------------------
# 16. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è > 20%
# -----------------------------------------------------------------------------
- id: crypto_portfolio_drawdown_critical
  alias: "Crypto: –ü—Ä–æ—Å–∞–¥–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è"
  description: "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ - —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_portfolio_current_drawdown
      above: 20
  action:
    - service: notify.mobile_app
      data:
        title: "üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–°–ê–î–ö–ê"
        message: "–ü—Ä–æ—Å–∞–¥–∫–∞ {{ states('sensor.crypto_inspect_portfolio_current_drawdown') }}%! –ü—Ä–æ–≤–µ—Ä—å –ø–æ–∑–∏—Ü–∏–∏!"
        data:
          priority: critical
          channel: crypto_critical

# -----------------------------------------------------------------------------
# 17. –ù–æ–≤—ã–π –º–∞–∫—Å–∏–º—É–º –ø–æ—Ä—Ç—Ñ–µ–ª—è
# -----------------------------------------------------------------------------
- id: crypto_portfolio_new_high
  alias: "Crypto: –ù–æ–≤—ã–π –º–∞–∫—Å–∏–º—É–º –ø–æ—Ä—Ç—Ñ–µ–ª—è"
  description: "–ü–æ—Ä—Ç—Ñ–µ–ª—å –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ ATH"
  trigger:
    - platform: template
      value_template: >
        {{ states('sensor.crypto_inspect_portfolio_current_drawdown') | float(10) == 0 }}
  condition:
    - condition: template
      value_template: >
        {{ states('sensor.crypto_inspect_bybit_total_portfolio') | float(0) > 1000 }}
  action:
    - service: notify.mobile_app
      data:
        title: "üéâ –ù–æ–≤—ã–π ATH –ø–æ—Ä—Ç—Ñ–µ–ª—è!"
        message: "–ü–æ—Ä—Ç—Ñ–µ–ª—å –¥–æ—Å—Ç–∏–≥ ${{ states('sensor.crypto_inspect_bybit_total_portfolio') | round(0) }}"

# -----------------------------------------------------------------------------
# 18. –ü—Ä–∏–±—ã–ª—å –∑–∞ 24—á > 5%
# -----------------------------------------------------------------------------
- id: crypto_portfolio_good_day
  alias: "Crypto: –•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–∏–±—ã–ª—å–Ω–æ–º –¥–Ω–µ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_portfolio_pnl_24h
      above: 5
  action:
    - service: notify.mobile_app
      data:
        title: "üí∞ –û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å!"
        message: "PnL –∑–∞ 24—á: +{{ states('sensor.crypto_inspect_portfolio_pnl_24h') }}%"

# -----------------------------------------------------------------------------
# 19. –£–±—ã—Ç–æ–∫ –∑–∞ 24—á > 5%
# -----------------------------------------------------------------------------
- id: crypto_portfolio_bad_day
  alias: "Crypto: –ü–ª–æ—Ö–æ–π –¥–µ–Ω—å"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —É–±—ã—Ç–æ—á–Ω–æ–º –¥–Ω–µ"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_portfolio_pnl_24h
      below: -5
  action:
    - service: notify.mobile_app
      data:
        title: "üìâ –¢—è–∂—ë–ª—ã–π –¥–µ–Ω—å"
        message: "PnL –∑–∞ 24—á: {{ states('sensor.crypto_inspect_portfolio_pnl_24h') }}%. –î–µ—Ä–∂–∏—Å—å!"

# -----------------------------------------------------------------------------
# 20. –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ (milestone)
# -----------------------------------------------------------------------------
- id: crypto_goal_milestone
  alias: "Crypto: Milestone –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_goal_progress
      above: 100
  action:
    - service: notify.mobile_app
      data:
        title: "üèÜ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê!"
        message: "–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¶–µ–ª—å {{ states('sensor.crypto_inspect_goal_target') }}$ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!"
        data:
          priority: high
    - service: persistent_notification.create
      data:
        title: "üèÜ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!"
        message: "–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!"

# -----------------------------------------------------------------------------
# 21. –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏ 25/50/75%
# -----------------------------------------------------------------------------
- id: crypto_goal_progress_milestone
  alias: "Crypto: –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ü–µ–ª–µ–π"
  trigger:
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_goal_progress
      above: 25
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_goal_progress
      above: 50
    - platform: numeric_state
      entity_id: sensor.crypto_inspect_goal_progress
      above: 75
  action:
    - service: notify.mobile_app
      data:
        title: "üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ü–µ–ª–∏"
        message: "{{ states('sensor.crypto_inspect_goal_progress') | round(0) }}% –∫ —Ü–µ–ª–∏ {{ states('sensor.crypto_inspect_goal_name') }}"

# -----------------------------------------------------------------------------
# 22. –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏
# -----------------------------------------------------------------------------
- id: crypto_liquidation_risk
  alias: "Crypto: –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏"
  description: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ä–∏—Å–∫–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_liq_risk_level
      to: "high"
  action:
    - service: notify.mobile_app
      data:
        title: "üö® –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏!"
        message: "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π. –ü—Ä–æ–≤–µ—Ä—å –º–∞—Ä–∂—É!"
        data:
          priority: critical

# -----------------------------------------------------------------------------
# 23. Stop-loss —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
# -----------------------------------------------------------------------------
- id: crypto_stop_loss_recommendation
  alias: "Crypto: Stop-loss —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è"
  description: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–æ–ø"
  trigger:
    - platform: state
      entity_id: sensor.crypto_inspect_stop_loss_recommendation
  condition:
    - condition: template
      value_template: "{{ trigger.to_state.state not in ['none', 'unknown', 'unavailable'] }}"
  action:
    - service: notify.mobile_app
      data:
        title: "üõ°Ô∏è Stop-Loss"
        message: "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: {{ states('sensor.crypto_inspect_stop_loss_recommendation') }}"
