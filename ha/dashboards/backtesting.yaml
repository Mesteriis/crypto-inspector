# Crypto Inspect - Backtesting Dashboard
# Strategy performance and backtesting results

title: Backtesting
path: backtesting
icon: mdi:chart-areaspline
type: sections
max_columns: 3
sections:
  # DCA Strategy Results
  - type: grid
    title: "üìà DCA Strategy Performance"
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_backtest_dca_roi
        name: Fixed DCA ROI
        icon: mdi:percent
        icon_color: |
          {% set roi = states('sensor.crypto_inspect_backtest_dca_roi') | float(0) %}
          {% if roi > 0 %}green{% elif roi < 0 %}red{% else %}orange{% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_backtest_smart_dca_roi
        name: Smart DCA ROI
        icon: mdi:brain
        icon_color: |
          {% set roi = states('sensor.crypto_inspect_backtest_smart_dca_roi') | float(0) %}
          {% if roi > 0 %}green{% elif roi < 0 %}red{% else %}orange{% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_backtest_lump_sum_roi
        name: Lump Sum ROI
        icon: mdi:cash
        icon_color: |
          {% set roi = states('sensor.crypto_inspect_backtest_lump_sum_roi') | float(0) %}
          {% if roi > 0 %}green{% elif roi < 0 %}red{% else %}orange{% endif %}

      - type: custom:mushroom-entity-card
        entity: sensor.crypto_inspect_backtest_best_strategy
        name: Best Strategy
        icon: mdi:trophy
        icon_color: gold

  # Performance Metrics
  - type: grid
    title: "üìä Performance Metrics"
    cards:
      - type: custom:mushroom-template-card
        primary: "Strategy Comparison"
        secondary: |
          DCA: {{ states('sensor.crypto_inspect_backtest_dca_roi') }}%
          Smart: {{ states('sensor.crypto_inspect_backtest_smart_dca_roi') }}%
          Lump: {{ states('sensor.crypto_inspect_backtest_lump_sum_roi') }}%
        icon: mdi:scale-balance

      - type: custom:mushroom-template-card
        primary: "Win Rate"
        secondary: |
          {% set win_rate = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'win_rate') %}
          {{ win_rate | default('N/A') }}%
        icon: mdi:trophy-variant
        icon_color: |
          {% set rate = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'win_rate') | default(50) | float %}
          {% if rate > 70 %}green{% elif rate > 50 %}orange{% else %}red{% endif %}

      - type: custom:mushroom-template-card
        primary: "Max Drawdown"
        secondary: |
          {% set dd = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'max_drawdown') %}
          {{ dd | default('N/A') }}%
        icon: mdi:trending-down
        icon_color: red

      - type: custom:mushroom-template-card
        primary: "Sharpe Ratio"
        secondary: |
          {% set sharpe = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'sharpe_ratio') %}
          {{ sharpe | default('N/A') }}
        icon: mdi:chart-areaspline
        icon_color: |
          {% set ratio = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'sharpe_ratio') | default(0) | float %}
          {% if ratio > 1 %}green{% elif ratio > 0 %}orange{% else %}red{% endif %}

  # Risk Analysis
  - type: grid
    title: "‚ö†Ô∏è Risk Assessment"
    cards:
      - type: custom:mushroom-template-card
        primary: "Risk Level"
        secondary: |
          {% set risk = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'risk_level') %}
          {{ risk | default('N/A') }}
        icon: mdi:shield-alert
        icon_color: |
          {% set risk = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'risk_level') %}
          {% if risk == 'Low' %}green{% elif risk == 'Medium' %}orange{% else %}red{% endif %}

      - type: custom:mushroom-template-card
        primary: "Volatility"
        secondary: |
          {% set vol = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'volatility') %}
          {{ vol | default('N/A') }}%
        icon: mdi:chart-bell-curve
        icon_color: |
          {% set vol = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'volatility') | default(20) | float %}
          {% if vol < 15 %}green{% elif vol < 30 %}orange{% else %}red{% endif %}

      - type: custom:mushroom-template-card
        primary: "Consistency"
        secondary: |
          {% set cons = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'consistency_score') %}
          {{ cons | default('N/A') }}/100
        icon: mdi:chart-line
        icon_color: |
          {% set score = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'consistency_score') | default(50) | int %}
          {% if score > 80 %}green{% elif score > 60 %}orange{% else %}red{% endif %}

  # Time Period Analysis
  - type: grid
    title: "‚è±Ô∏è Time-Based Performance"
    cards:
      - type: custom:mushroom-template-card
        primary: "Monthly Returns"
        secondary: |
          {% set monthly = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'monthly_returns') %}
          Avg: {{ monthly | default([]) | sum | float | round(2) }}%
        icon: mdi:calendar-month

      - type: custom:mushroom-template-card
        primary: "Quarterly Performance"
        secondary: |
          {% set quarterly = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'quarterly_performance') %}
          {{ quarterly | default('N/A') }}
        icon: mdi:calendar-quarter

      - type: custom:mushroom-template-card
        primary: "Annualized Return"
        secondary: |
          {% set annual = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'annualized_return') %}
          {{ annual | default('N/A') }}%
        icon: mdi:calendar-year
        icon_color: |
          {% set ret = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'annualized_return') | default(0) | float %}
          {% if ret > 20 %}green{% elif ret > 5 %}orange{% else %}red{% endif %}

  # Trade Statistics
  - type: grid
    title: "üî¢ Trade Statistics"
    cards:
      - type: custom:mushroom-template-card
        primary: "Total Trades"
        secondary: |
          {% set trades = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'total_trades') %}
          {{ trades | default('N/A') }}
        icon: mdi:format-list-numbered

      - type: custom:mushroom-template-card
        primary: "Avg Trade Size"
        secondary: |
          {% set size = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'avg_trade_size') %}
          ${{ size | default('N/A') }}
        icon: mdi:cash-multiple

      - type: custom:mushroom-template-card
        primary: "Best Trade"
        secondary: |
          {% set best = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'best_trade') %}
          {{ best | default('N/A') }}%
        icon: mdi:thumb-up
        icon_color: green

      - type: custom:mushroom-template-card
        primary: "Worst Trade"
        secondary: |
          {% set worst = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'worst_trade') %}
          {{ worst | default('N/A') }}%
        icon: mdi:thumb-down
        icon_color: red

  # Strategy Recommendations
  - type: grid
    title: "üí° Recommendations"
    cards:
      - type: custom:mushroom-template-card
        primary: "Recommended Strategy"
        secondary: |
          {{ states('sensor.crypto_inspect_backtest_best_strategy') }}
        icon: mdi:lightbulb-on
        icon_color: amber

      - type: custom:mushroom-template-card
        primary: "Optimal Frequency"
        secondary: |
          {% set freq = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'optimal_frequency') %}
          {{ freq | default('N/A') }}
        icon: mdi:clock-time-four-outline

      - type: custom:mushroom-template-card
        primary: "Risk-Adjusted Return"
        secondary: |
          {% set rar = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'risk_adjusted_return') %}
          {{ rar | default('N/A') }}
        icon: mdi:chart-bar-stacked
        icon_color: |
          {% set rar = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'risk_adjusted_return') | default(0) | float %}
          {% if rar > 0.5 %}green{% elif rar > 0 %}orange{% else %}red{% endif %}

      - type: custom:mushroom-template-card
        primary: "Confidence Level"
        secondary: |
          {% set conf = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'confidence_level') %}
          {{ conf | default('N/A') }}%
        icon: mdi:head-question
        icon_color: |
          {% set conf = state_attr('sensor.crypto_inspect_backtest_dca_roi', 'confidence_level') | default(50) | int %}
          {% if conf > 80 %}green{% elif conf > 60 %}orange{% else %}red{% endif %}
