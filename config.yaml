# Конфигурация Home Assistant Add-on
# https://developers.home-assistant.io/docs/add-ons/configuration

name: "Crypto Inspect"
description: "Сбор и анализ данных криптовалютных свечей"
version: "0.2.4"
slug: "crypto_inspect"
url: "https://github.com/Mesteriis/crypto-inspector"
arch:
  - amd64
  - aarch64
homeassistant_api: true
ingress: true
ingress_port: 0
host_network: true
panel_icon: "mdi:chart-line"
panel_title: "Crypto Inspect"

services:
  - mysql:want
  - mqtt:want

ports:
  9999/tcp: 9999
  9998/tcp: 9998
ports_description:
  9999/tcp: "API порт для сенсоров Home Assistant"
  9998/tcp: "MCP сервер для интеграции с AI-агентами"

# Минимальные настройки - всё работает из коробки
options:
  symbols:
    - "BTCUSDT"
    - "ETHUSDT"

# Схема с дефолтами - все поля опциональны
schema:
  # === Основные ===
  api_port: port?
  log_level: list(debug|info|warning|error)?
  symbols:
    - str

  # === База данных ===
  database_type: list(sqlite|postgres)?
  postgres_host: str?
  postgres_port: port?
  postgres_database: str?
  postgres_username: str?
  postgres_password: password?
  redis_url: str?

  # === Анализ рынка ===
  fetch_interval_minutes: int(1,1440)?
  analysis_enabled: bool?
  analysis_interval_hours: int(1,24)?
  alert_on_strong_signals: bool?
  alert_threshold_buy: int(50,100)?
  alert_threshold_sell: int(0,50)?

  # === Биржи ===
  bybit_api_key: password?
  bybit_api_secret: password?
  bybit_testnet: bool?

  # === MCP Server ===
  mcp_enabled: bool?
  mcp_port: port?

  # === Загрузка истории ===
  backfill_enabled: bool?
  backfill_crypto_years: int(1,15)?
  backfill_traditional_years: int(1,5)?

  # === AI анализ ===
  ai_enabled: bool?
  ai_provider: list(ollama|openai)?
  openai_api_key: password?
  ollama_host: str?
  ollama_model: str?
  ai_analysis_interval_hours: int(1,168)?
  ai_language: list(en|ru)?

  # === Цели и уведомления ===
  goal_enabled: bool?
  goal_target_value: int(1000,100000000)?
  goal_name: str?
  briefing_morning_enabled: bool?
  briefing_evening_enabled: bool?
  notification_mode: list(all|smart|digest_only|critical_only|silent)?

map:
  - config:ro
  - ssl:ro
  - share:rw

startup: services
stage: experimental
