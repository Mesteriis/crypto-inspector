# ==============================================================================
# CRYPTO ANALYZER - КОНФИГУРАЦИЯ
# ==============================================================================
# Базовая конфигурация системы технического анализа криптовалют
# ==============================================================================

# ------------------------------------------------------------------------------
# ОБЩИЕ НАСТРОЙКИ
# ------------------------------------------------------------------------------
general:
  # Валюта для отображения цен
  base_currency: "USD"
  # Альтернативная валюта
  alt_currency: "EUR"
  # Часовой пояс
  timezone: "Europe/Madrid"
  # Уровень логирования: DEBUG, INFO, WARNING, ERROR
  log_level: "INFO"

# ------------------------------------------------------------------------------
# СПИСОК МОНЕТ ДЛЯ ОТСЛЕЖИВАНИЯ
# ------------------------------------------------------------------------------
# Базовый список (всегда отслеживается)
# Дополнительные монеты добавляются через UI (input_text.crypto_watchlist_custom)
coins:
  # Основные монеты (обязательный анализ)
  primary:
    - symbol: "BTC"
      name: "Bitcoin"
      coingecko_id: "bitcoin"
      binance_symbol: "BTCUSDT"
      bybit_symbol: "BTCUSDT"
      has_options: true
      has_onchain: true

    - symbol: "ETH"
      name: "Ethereum"
      coingecko_id: "ethereum"
      binance_symbol: "ETHUSDT"
      bybit_symbol: "ETHUSDT"
      has_options: true
      has_onchain: true

  # Вторичные монеты (базовый анализ)
  secondary:
    - symbol: "SOL"
      name: "Solana"
      coingecko_id: "solana"
      binance_symbol: "SOLUSDT"
      bybit_symbol: "SOLUSDT"
      has_options: true
      has_onchain: false

    - symbol: "ADA"
      name: "Cardano"
      coingecko_id: "cardano"
      binance_symbol: "ADAUSDT"
      bybit_symbol: "ADAUSDT"
      has_options: false
      has_onchain: false

    - symbol: "XRP"
      name: "Ripple"
      coingecko_id: "ripple"
      binance_symbol: "XRPUSDT"
      bybit_symbol: "XRPUSDT"
      has_options: false
      has_onchain: false

    - symbol: "DOT"
      name: "Polkadot"
      coingecko_id: "polkadot"
      binance_symbol: "DOTUSDT"
      bybit_symbol: "DOTUSDT"
      has_options: false
      has_onchain: false

# ------------------------------------------------------------------------------
# ИСТОЧНИКИ ДАННЫХ
# ------------------------------------------------------------------------------
data_sources:
  # Приоритет источников (первый = основной)
  priority:
    - "binance"
    - "bybit"
    - "coingecko"

  binance:
    base_url: "https://api.binance.com/api/v3"
    klines_endpoint: "/klines"
    # Лимиты: 1200 запросов/мин
    rate_limit: 1200
    max_candles_per_request: 1000

  bybit:
    base_url: "https://api.bybit.com/v5/market"
    klines_endpoint: "/kline"
    rate_limit: 120
    max_candles_per_request: 1000

  coingecko:
    base_url: "https://api.coingecko.com/api/v3"
    # Лимиты: 10-30 запросов/мин (бесплатный tier)
    rate_limit: 10
    # OHLC данные ограничены (1/7/14/30/90/180/365 дней)
    max_days: 365

# ------------------------------------------------------------------------------
# ТАЙМФРЕЙМЫ
# ------------------------------------------------------------------------------
timeframes:
  "30m":
    binance_interval: "30m"
    bybit_interval: "30"
    candles_to_store: 4000  # ~83 дня
    update_interval_minutes: 30

  "1h":
    binance_interval: "1h"
    bybit_interval: "60"
    candles_to_store: 3000  # ~125 дней
    update_interval_minutes: 60

  "4h":
    binance_interval: "4h"
    bybit_interval: "240"
    candles_to_store: 2000  # ~1 год
    update_interval_minutes: 240

  "1d":
    binance_interval: "1d"
    bybit_interval: "D"
    candles_to_store: 3650  # 10 лет
    update_interval_minutes: 1440

  "1w":
    binance_interval: "1w"
    bybit_interval: "W"
    candles_to_store: 520  # 10 лет
    update_interval_minutes: 10080

# ------------------------------------------------------------------------------
# ТЕХНИЧЕСКИЙ АНАЛИЗ
# ------------------------------------------------------------------------------
technical_analysis:
  # Moving Averages
  sma_periods: [20, 50, 200]
  ema_periods: [12, 26]

  # RSI
  rsi_period: 14
  rsi_oversold: 30
  rsi_overbought: 70

  # MACD
  macd_fast: 12
  macd_slow: 26
  macd_signal: 9

  # Bollinger Bands
  bb_period: 20
  bb_std: 2

  # ATR
  atr_period: 14

# ------------------------------------------------------------------------------
# ОПРЕДЕЛЕНИЕ ЦИКЛОВ
# ------------------------------------------------------------------------------
cycles:
  # Bitcoin Halving dates
  halving_dates:
    - "2012-11-28"
    - "2016-07-09"
    - "2020-05-11"
    - "2024-04-20"
    - "2028-04-15"  # estimated

  # Фазы цикла и их характеристики
  phases:
    accumulation:
      description: "Накопление"
      description_ru: "Накопление после медвежьего рынка"
      typical_duration_months: 6-12

    early_bull:
      description: "Ранний бычий"
      description_ru: "Начало бычьего тренда"
      typical_duration_months: 6-12

    bull:
      description: "Бычий рынок"
      description_ru: "Основной бычий тренд"
      typical_duration_months: 6-12

    distribution:
      description: "Распределение"
      description_ru: "Фиксация прибыли на вершине"
      typical_duration_months: 1-3

    bear:
      description: "Медвежий рынок"
      description_ru: "Медвежий тренд"
      typical_duration_months: 12-18

# ------------------------------------------------------------------------------
# ON-CHAIN МЕТРИКИ
# ------------------------------------------------------------------------------
onchain:
  sources:
    cryptoquant:
      base_url: "https://api.cryptoquant.com/v1"
      # Требуется API ключ для большинства endpoints

    glassnode:
      base_url: "https://api.glassnode.com/v1"
      # Бесплатный tier ограничен

  metrics:
    mvrv:
      oversold_threshold: 0.8
      overbought_threshold: 3.5

    sopr:
      capitulation_threshold: 0.95

    nvt:
      undervalued_threshold: 50
      overvalued_threshold: 150

# ------------------------------------------------------------------------------
# ДЕРИВАТИВЫ
# ------------------------------------------------------------------------------
derivatives:
  funding_rate:
    extreme_positive: 0.1  # 0.1% = очень бычий сентимент
    extreme_negative: -0.05  # -0.05% = очень медвежий

  open_interest:
    significant_change_percent: 10  # 10% изменение = значимое

# ------------------------------------------------------------------------------
# WHALE TRACKING
# ------------------------------------------------------------------------------
whales:
  # Пороги для определения "кита"
  thresholds:
    BTC: 1000  # BTC
    ETH: 10000  # ETH
    USD: 50000000  # $50M

  # Источники
  sources:
    - "whale_alert"
    - "blockchain_com"
    - "etherscan"

# ------------------------------------------------------------------------------
# ARBITRAGE
# ------------------------------------------------------------------------------
arbitrage:
  # Минимальный профит после комиссий (%)
  min_profit_percent: 0.5

  # Максимальное время на исполнение (минуты)
  max_execution_time: 15

  # Комиссии бирж (taker)
  exchange_fees:
    binance: 0.1
    bybit: 0.1
    okx: 0.1
    kraken: 0.26
    coinbase: 0.6

# ------------------------------------------------------------------------------
# STAKING / DEFI
# ------------------------------------------------------------------------------
defi:
  sources:
    defillama:
      base_url: "https://yields.llama.fi"

  # Минимальный APY для отображения
  min_apy_percent: 1.0

  # Типы риска
  risk_levels:
    low: ["native_staking", "liquid_staking_top"]
    medium: ["cex_staking", "lending_top"]
    high: ["lp_farming", "new_protocols"]

# ------------------------------------------------------------------------------
# NEWS
# ------------------------------------------------------------------------------
news:
  sources:
    cryptopanic:
      base_url: "https://cryptopanic.com/api/v1"
      # Бесплатный API ключ

    rss_feeds:
      - "https://www.coindesk.com/arc/outboundfeeds/rss/"
      - "https://cointelegraph.com/rss"
      - "https://decrypt.co/feed"

  # Ключевые слова для фильтрации
  keywords:
    bullish: ["etf approved", "adoption", "partnership", "institutional"]
    bearish: ["hack", "exploit", "bankruptcy", "ban", "regulation"]
    breaking: ["breaking", "just in", "urgent"]

# ------------------------------------------------------------------------------
# SCORING ENGINE
# ------------------------------------------------------------------------------
scoring:
  # Веса компонентов (должны суммироваться в 1.0)
  weights:
    technical: 0.15
    onchain: 0.15
    mtf_confluence: 0.12
    ml_prediction: 0.10
    options_flow: 0.10
    news_sentiment: 0.08
    whale_activity: 0.08
    sentiment: 0.07
    derivatives: 0.07
    macro: 0.05
    cycle: 0.03

  # Интерпретация скоров
  interpretation:
    strong_buy: 80
    buy: 60
    neutral: 40
    caution: 20

# ------------------------------------------------------------------------------
# DCA КАЛЬКУЛЯТОР
# ------------------------------------------------------------------------------
dca:
  # Множители по условиям
  multipliers:
    fear_greed:
      extreme_fear: 2.0  # F&G < 20
      fear: 1.5  # F&G 20-35
      neutral: 1.0  # F&G 35-65
      greed: 0.5  # F&G 65-80
      extreme_greed: 0.25  # F&G > 80

    rsi:
      oversold_bonus: 0.5  # RSI < 30
      overbought_penalty: -0.25  # RSI > 70

    cycle:
      accumulation_bonus: 0.3
      distribution_penalty: -0.3

# ------------------------------------------------------------------------------
# УВЕДОМЛЕНИЯ
# ------------------------------------------------------------------------------
notifications:
  # Типы уведомлений и их приоритет
  types:
    pattern:
      priority: "normal"
      cooldown_hours: 24

    cycle_change:
      priority: "high"
      cooldown_hours: 0  # без cooldown

    whale_alert:
      priority: "normal"
      cooldown_hours: 1

    arbitrage:
      priority: "high"
      cooldown_hours: 0

    price_alert:
      priority: "high"
      cooldown_hours: 24

    breaking_news:
      priority: "critical"
      cooldown_hours: 0

# ------------------------------------------------------------------------------
# OLLAMA (AI)
# ------------------------------------------------------------------------------
ollama:
  host: "192.168.1.2"
  port: 11434
  model: "llama3.2"  # или другая модель
  timeout: 30

# ------------------------------------------------------------------------------
# API КЛЮЧИ
# ------------------------------------------------------------------------------
# Ключи можно задать здесь или через environment variables
# Переменные окружения имеют приоритет над значениями в файле
#
# Для использования через HA secrets:
# 1. Добавьте ключи в /config/secrets.yaml
# 2. Установите env переменные в shell_command или systemd service
#
# Environment variables:
#   WHALE_ALERT_API_KEY, ETHERSCAN_API_KEY, CRYPTOPANIC_API_KEY,
#   GLASSNODE_API_KEY, LUNARCRUSH_API_KEY, COINGLASS_API_KEY, SANTIMENT_API_KEY
api_keys:
  # Whale Alert - отслеживание крупных транзакций
  # https://whale-alert.io/ (бесплатно: 10 req/min)
  whale_alert: ""

  # Etherscan - Ethereum blockchain данные
  # https://etherscan.io/apis (бесплатно: 5 req/sec)
  etherscan: ""

  # CryptoPanic - крипто новости
  # https://cryptopanic.com/developers/api/ (бесплатно: базовый доступ)
  cryptopanic: ""

  # Glassnode - on-chain метрики (MVRV, SOPR, NVT)
  # https://studio.glassnode.com/settings/api (бесплатно: ограниченные метрики)
  glassnode: ""

  # LunarCrush - social volume, sentiment
  # https://lunarcrush.com/developers/api (бесплатно: 100 req/day)
  lunarcrush: ""

  # CoinGlass - деривативы (OI, liquidations, funding)
  # https://www.coinglass.com/pricing (бесплатно: базовые данные)
  coinglass: ""

  # Santiment - on-chain + social analytics
  # https://app.santiment.net/account#api-keys (бесплатно: ограниченно)
  santiment: ""

# ------------------------------------------------------------------------------
# ПУТИ К ФАЙЛАМ
# ------------------------------------------------------------------------------
paths:
  # SQLite база данных
  database: "/config/_tools/crypto_analyzer/data/crypto_history.db"
  # Логи
  logs: "/config/_tools/crypto_analyzer/logs/"
  # Кэш
  cache: "/config/_tools/crypto_analyzer/cache/"
